

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Android Gradle</title>
    <meta name="keywords" content="gradle">
    
    <meta name="author" content="stormzhang">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <link href="/css/typo.css" rel="stylesheet">
    <link href="/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/css/solarized.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/datatables-bootstrap.css" rel="stylesheet">
    <link href="/css/codepiano.css" rel="stylesheet">

    <!-- javascript files -->
    <script type="text/javascript" src="/js/jquery-2.0.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/js/datatables-bootstrap.js"></script>
    <script type="text/javascript" src="/js/codepiano.js"></script>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script type="text/javascript">
    </script>

  </head>

  <body id="scroll-pane" data-spy="scroll" data-target="#time-list-nav">
    <div class="wrapper">
      <!-- 导航条 -->
      <div class="navbar">
        <div class="navbar-inner row-fluid">
          <div class="span2">
          </div>
          <div class="span8">
            <a class="brand" href="/">
              <span class="site-author"> stormzhang </span>
              <span class="site-title"> /* 做好现在的事儿 */ </span>
            </a>
            <ul class="nav">
              
              
              





<li class="posts"><a href="/posts.html">目录</a></li>
<li class="timeline"><a href="/timeline.html">时间线</a></li>
<li class="categories"><a href="/categories.html">分类</a></li>
<li class="about"><a href="/about.html">关于</a></li>

            </ul>
          </div>
          <div class="span2">
          </div>
        </div>
      </div>

      <!-- 正文 -->
      

<div class="row-fluid post-full typo">
  <div class="span2"></div>
  <div class="span8 typo">
    <h2>Android Gradle </h2>
    <div class="post_info">
      
      <ul class="tag_box inline">
        <li><i class="icon-calendar"></i></li>
        <li> 2014 年 02 月 28 日</li>
        <li><i class="icon-folder-open"></i></li>
        
        
 
  <li>
    <a href="/categories.html#android-ref">
      android 
    </a>
  </li>
  



      </ul>
        
    </div>
    <div class="content">
      
<p>Google I/O 2013发布了新的开发工具Android Studio和新的构建系统<a href="http://tools.android.com/tech-docs/new-build-system">Gradle</a>， Android Studio自不必说，这是Android IDE的未来。这篇文章就来学习下Gradle。</p>

<h2 id="gradle">什么是Gradle？</h2>

<p>Gradle 是以 Groovy 语言为基础，面向Java应用为主，基于DSL语法的自动化构建工具。说到Java的自动化构建工具，大家一定对Ant和Maven都不会陌生，对，Gradle就是这样一种类似的工具，不过它比Ant和Maven强大的多，而且使用起来更加方便简单并且兼容Maven。</p>

<p>下面列举了一些使用Gradle构建Android项目的好处：</p>

<ul>
  <li>
    <p>在IDE环境和命令行下使用同一个构建系统</p>
  </li>
  <li>
    <p>改进的依赖关系管理</p>
  </li>
  <li>
    <p>更容易地集成到自动化构建系统</p>
  </li>
</ul>

<h2 id="gradle-1">安装Gradle</h2>

<p>如果你是用Android Studio，第一次运行的时候需要自动安装Gradle，这个过程很漫长，而且有可能需要翻墙才下载的了，所以很多用户以致于认为死机了，所以最好的办法是手动来安装吧。</p>

<p>由于自己是mac电脑，所以以下仅以OSX系统为例，Windows系统的请自行网上搜索安装过程。</p>

<p>首先去<a href="http://www.gradle.org/downloads">Gradle</a>官网下载最新版本，目前最新版本是1.11,如下图直接下载并解压gradle-1.11-all.zip放到一个目录下（当然你可以选择直接下载bin），之后建立软连接:</p>

<p><img src="/image/gradle_download.png" /></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cd</span> <span class="sr">/usr/</span><span class="n">bin</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/Users/s</span><span class="n">torm</span><span class="o">/</span><span class="n">gradle</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gradle</span> <span class="n">gradle</span>
<span class="c1">#-&gt; /Users/storm/gradle/bin/gradle是我放gradle的目录</span></code></pre></div>

<p>之后在命令行下输入gradle -v，如果显示了版本的信息则安装成功了。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gradle</span> <span class="o">-</span><span class="n">v</span>

<span class="o">------------------------------------------------------------</span>
<span class="no">Gradle</span> <span class="mi">1</span><span class="o">.</span><span class="mi">11</span>
<span class="o">------------------------------------------------------------</span>

<span class="no">Build</span> <span class="ss">time</span><span class="p">:</span>   <span class="mi">2014</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">11</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">39</span> <span class="no">UTC</span>
<span class="no">Build</span> <span class="ss">number</span><span class="p">:</span> <span class="n">none</span>
<span class="ss">Revision</span><span class="p">:</span>     <span class="n">a831fa866d46cbee94e61a09af15f9dd95987421</span>

<span class="ss">Groovy</span><span class="p">:</span>       <span class="mi">1</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">6</span>
<span class="ss">Ant</span><span class="p">:</span>          <span class="no">Apache</span> <span class="no">Ant</span><span class="p">(</span><span class="no">TM</span><span class="p">)</span> <span class="n">version</span> <span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">2</span> <span class="n">compiled</span> <span class="n">on</span> <span class="no">July</span> <span class="mi">8</span> <span class="mi">2013</span>
<span class="ss">Ivy</span><span class="p">:</span>          <span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span>
<span class="ss">JVM</span><span class="p">:</span>          <span class="mi">1</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="mo">0_65</span> <span class="p">(</span><span class="no">Apple</span> <span class="no">Inc</span><span class="o">.</span> <span class="mi">20</span><span class="o">.</span><span class="mi">65</span><span class="o">-</span><span class="n">b04</span><span class="o">-</span><span class="mi">462</span><span class="p">)</span>
<span class="ss">OS</span><span class="p">:</span>           <span class="no">Mac</span> <span class="no">OS</span> <span class="n">X</span> <span class="mi">10</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">1</span> <span class="n">x86_64</span></code></pre></div>

<h2 id="gradle-">Gradle 基本概念</h2>

<p>如果你用Android Studio新建一个项目的时候，默认生成一大堆关于gradle的东西，其中最重要的是一个build.gradle的文件，内容如下：</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">buildscript</span> <span class="p">{</span>
    <span class="n">repositories</span> <span class="p">{</span>
        <span class="n">mavenCentral</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">dependencies</span> <span class="p">{</span>
        <span class="n">classpath</span> <span class="s1">&#39;com.android.tools.build:gradle:0.8.+&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">apply</span> <span class="ss">plugin</span><span class="p">:</span> <span class="s1">&#39;android&#39;</span>

<span class="n">android</span> <span class="p">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">19</span>
    <span class="n">buildToolsVersion</span> <span class="s2">&quot;19.0.0&quot;</span>

    <span class="n">defaultConfig</span> <span class="p">{</span>
        <span class="n">minSdkVersion</span> <span class="mi">14</span>
        <span class="n">targetSdkVersion</span> <span class="mi">19</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="p">}</span>
    <span class="n">buildTypes</span> <span class="p">{</span>
        <span class="n">release</span> <span class="p">{</span>
            <span class="n">runProguard</span> <span class="kp">false</span>
            <span class="n">proguardFiles</span> <span class="n">getDefaultProguardFile</span><span class="p">(</span><span class="s1">&#39;proguard-android.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;proguard-rules.txt&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">dependencies</span> <span class="p">{</span>
    <span class="n">compile</span> <span class="s1">&#39;com.android.support:support-v4:19.0.+&#39;</span>
<span class="p">}</span></code></pre></div>

<p>buildscript节点的内容完全不用动，大概意思就是支持maven，声明Gradle的版本，刚开始很纳闷0.8是什么意思，Gradle的版本不是1.11么，我搜了好久都不知道这个数字和版本有什么关系，后来在<a href="http://tools.android.com/tech-docs/new-build-system">http://tools.android.com/tech-docs/new-build-system</a>上有一项release note，才大概知道是如何对应起来的。</p>

<p><img src="/image/gradle_release_note.png" /></p>

<p>apply plugin节点声明构建的项目类型，这里当然是android了</p>

<p>android节点设置编译android项目的参数，接下来，我们的构建android项目的所有配置都在这里完成。相信上述都能看懂，就简单的字面意思。</p>

<h2 id="gradle-android">构建一个Gradle Android项目</h2>

<p>上述算是一个最基本的Android Gradle配置文件了，但是如果项目中引用了一些第三方的jar包，则需要添加些东西,比如项目依赖了一个sunpport_v4的jar包，则完整的build.gradle文件如下：</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">buildscript</span> <span class="p">{</span>
    <span class="n">repositories</span> <span class="p">{</span>
        <span class="n">mavenCentral</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">dependencies</span> <span class="p">{</span>
        <span class="n">classpath</span> <span class="s1">&#39;com.android.tools.build:gradle:0.8.+&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">apply</span> <span class="ss">plugin</span><span class="p">:</span> <span class="s1">&#39;android&#39;</span>

<span class="n">android</span> <span class="p">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">19</span>
    <span class="n">buildToolsVersion</span> <span class="s2">&quot;19.0.0&quot;</span>

    <span class="n">defaultConfig</span> <span class="p">{</span>
        <span class="n">minSdkVersion</span> <span class="mi">14</span>
        <span class="n">targetSdkVersion</span> <span class="mi">19</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="p">}</span>
    <span class="n">buildTypes</span> <span class="p">{</span>
        <span class="n">release</span> <span class="p">{</span>
            <span class="n">runProguard</span> <span class="kp">false</span>
            <span class="n">proguardFiles</span> <span class="n">getDefaultProguardFile</span><span class="p">(</span><span class="s1">&#39;proguard-android.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;proguard-rules.txt&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">dependencies</span> <span class="p">{</span>
	<span class="sr">//</span><span class="err">单文件依赖</span>
    <span class="n">compile</span> <span class="n">files</span><span class="p">(</span><span class="s1">&#39;libs/android-support-v4.jar&quot;)</span>
<span class="s1">    //某个文件夹下面全部依赖</span>
<span class="s1">    compile fileTree(dir: &#39;</span><span class="n">libs</span><span class="s1">&#39;, include: &#39;</span><span class="o">*.</span><span class="n">jar</span><span class="err">&#39;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>接着在命令行cd 到项目目录下</p>

<pre><code>gradle clean
</code></pre>

<p>如果是第一次使用gradle构建，则会下载相关依赖包并且对环境进行初始化，如果出错了，一般可能是下载超时，试多几次即可，最后你会看到如下提示：BUILD SUCCESSFUL
完成以上的步骤，就可以正式使用gralde 构建你的android项目了。</p>

<p>接着执行</p>

<pre><code>gradle build
</code></pre>

<p>就完成了android 项目的构建了。如果，你是照着以上步骤走的话，你将会在项目目录里面看到一个build 的目录，里面就是用gradle 构建android项目的全部东西了。最终打包的apk 就在build/apk 目录下了。然后，你会发现，两个apk 一个是 [项目名]-debug-unaligned [项目名]-release-unsigned，看名字就猜到一个是调试模式没有进行优化的apk（可直接安装），一个是release模式但没有签名的apk（不可直接安装）。</p>

<h2 id="section">打签名包</h2>

<p>默认输出 release apk 是没有签名的，那么我们需要签名的很简单，只需要在android{}里面补充加上如下代码即可。</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">signingConfigs</span> <span class="p">{</span>
    <span class="n">myConfig</span> <span class="p">{</span>
        <span class="n">storeFile</span> <span class="n">file</span><span class="p">(</span><span class="s2">&quot;storm.keystore&quot;</span><span class="p">)</span>
        <span class="n">storePassword</span> <span class="s2">&quot;storm&quot;</span>
        <span class="n">keyAlias</span> <span class="s2">&quot;storm&quot;</span>
        <span class="n">keyPassword</span> <span class="s2">&quot;storm&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
    
<span class="n">buildTypes</span><span class="p">{</span>
    <span class="n">release</span> <span class="p">{</span>
        <span class="n">signingConfig</span>  <span class="n">signingConfigs</span><span class="o">.</span><span class="n">myConfig</span>
        <span class="n">runProguard</span> <span class="kp">true</span>
        <span class="n">proguardFiles</span> <span class="n">getDefaultProguardFile</span><span class="p">(</span><span class="s1">&#39;proguard-android.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;proguard-rules.txt&#39;</span>
    <span class="p">}</span> 
<span class="p">}</span></code></pre></div>

<p>然后，运行</p>

<pre><code>gradle clean 
gradle build 
</code></pre>

<p>接着在build/apk目录下就生成了我们需要的签名的apk。</p>

<h2 id="section-1">更多</h2>

<p>实际项目中我们的app可以会很复杂，比如不仅引用到一些jar文件，也可能会引用一些Android Library项目以及一些.so文件，而且实际发布的时候我们可能不仅需要发布到一个平台上，目前Android大大小小可能得十几个平台，所以用Gradle就无法解决这些问题呢，答案是否定的，Gradle通过一些其他的配置都可以解决，只是稍微要麻烦些，等待以后有时间有精力的时候再总结下。顺便说下Gradle是Google大力支持的，所以和Android Studio类似，都是Android的未来，作为Android开发者有必要学习并跟上时代的步伐。</p>

    </div>

    
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      
   
    <li><a href="/posts.html#Gradle">Gradle <span>5</span></a></li>
  



    </ul>
      

    <hr>
    <div class="pagination pull-right">
      <ul>
        
        <li class="prev"><a href="/android/2014/02/21/android-instancestate" title="Android InstanceState">&larr; Previous</a></li>
        
        <li><a href="/posts.html">Archive</a></li>
        
        <li class="next"><a href="/other/2014/03/06/expected-develop-environment" title="我理想的工作环境">Next &rarr;</a></li>
        
      </ul>
    </div>

  <br />
    <div id="comment-hook"></div>
    <!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/android/2014/02/28/android-gradle" data-title="Android Gradle" data-url="/android/2014/02/28/android-gradle"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"stormzhang"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

  </div>
  <div class="span2"></div>
</div>



    

  </body>
</html>

